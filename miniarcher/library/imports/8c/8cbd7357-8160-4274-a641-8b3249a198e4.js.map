{"version":3,"sources":["../../../../../assets/script/view/assets/script/view/PolyTargetNode.js"],"names":["Utils","require","cc","Class","extends","Component","properties","length","default","visible","index","skinName","onLoad","start","init","info","node","position","v2","startX","startY","speed","penetratable","awardGold","awardArrow","awardTime","skinType","mustShoot","zIndex","opacity","updateSkin","move","frame","gameInstance","gameView","ui_main","getSpriteFrame","getComponent","Sprite","spriteFrame","width","_rect","height","explode","active","go","instantiate","booms","parent","soundManager","playSound","pos","convertToWorldSpaceAR","addArrow","Math","random","go1","addArrowNo","addGoldNo","convertToNodeSpaceAR","scale","runAction","sequence","scaleTo","easing","easeQuadraticActionInOut","easeQuadraticActionIn","delayTime","fadeOut","getChildByName","Label","string","arrowNum","updateArrow","playerInfo","gold","sys","localStorage","setItem","updateGold","sdkHelper","uploadPlayerInfo","playPart","particles","moving","stopAllActions","getCurLevelInfo","targets","getCurTargetsInfo","next","undefined","polyType","moveTo","callFunc","bind","fadeIn","stopMove","pauseMove","pauseAllActions","resumeMove","resumeAllActions"],"mappings":"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","file":"PolyTargetNode.js","sourceRoot":"../../../../../assets/script/view","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nvar Utils = require(\"../Utils/Utils\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        length:{\n            default:450,\n            visible:false,\n        },\n        index:{\n            default:0,\n            visible:false,\n        },\n        skinName:{\n            default:[],\n            visible:false,\n        }\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        this.skinName = [\"target1\",\"target_balloon\",\"target_glass\",\"target_wood\"];\n    },\n\n    start () {\n    },\n    \n    init(info, index){\n        this.node.position = cc.v2(cc.v2(info.startX, info.startY));\n        this.speed = info.speed;\n        this.penetratable = info.penetratable;\n        this.awardGold = info.awardGold;\n        this.awardArrow = info.awardArrow;\n        this.awardTime = info.awardTime;\n        this.skinType = info.skinType;\n        this.mustShoot = info.mustShoot;\n        this.index = index;\n        this.node.zIndex = 10 - index;\n        this.node.opacity = 255;\n        this.updateSkin();\n        this.move();\n        // console.log(\"startMove\");\n    },\n\n    updateSkin(){\n        let frame = gameInstance.gameView.ui_main.getSpriteFrame(this.skinName[this.skinType - 1])\n        this.node.getComponent(cc.Sprite).spriteFrame = frame;\n       \n        this.node.width = frame._rect.width;\n        this.node.height = frame._rect.height;\n    },\n    \n    explode(){\n        if(this.skinType == 1) return;\n        this.node.active = false;\n        let gameView = gameInstance.gameView;\n        let go = cc.instantiate(gameView.booms[this.skinType - 2].node);\n        go.parent = this.node.parent;\n        go.position = this.node.position;\n        go.active = true;\n        if(this.skinType == 2) {\n            gameInstance.soundManager.playSound(\"ballon\");\n\n            let pos = this.node.convertToWorldSpaceAR(cc.v2(0,0));\n            let addArrow = Math.random() > .5;\n            let go1 = cc.instantiate(addArrow ? gameView.addArrowNo : gameView.addGoldNo);\n            go1.parent = gameView.node;\n            go1.position = gameView.node.convertToNodeSpaceAR(pos);\n            go1.active = true;\n            go1.scale = 1.2;\n            go1.runAction(cc.sequence(\n                cc.scaleTo(.15, .8).easing(cc.easeQuadraticActionInOut()),\n                cc.scaleTo(.15, 1.12).easing(cc.easeQuadraticActionInOut()),\n                cc.scaleTo(.15, 0.88).easing(cc.easeQuadraticActionInOut()),\n                cc.scaleTo(.15, 1.05).easing(cc.easeQuadraticActionInOut()),\n                cc.scaleTo(.15, .95).easing(cc.easeQuadraticActionInOut()),\n                cc.scaleTo(.15, 1).easing(cc.easeQuadraticActionIn()),\n                cc.delayTime(.2),\n                cc.fadeOut(.5),\n            ))\n\n            if(addArrow){\n                go1.getChildByName(\"label\").getComponent(cc.Label).string = \"\" + this.awardArrow;\n                gameInstance.gameView.arrowNum += this.awardArrow;\n                gameInstance.gameView.updateArrow();\n            }\n            else{\n                go1.getChildByName(\"label\").getComponent(cc.Label).string = \"\" + this.awardGold;\n                playerInfo.gold += this.awardGold;\n                cc.sys.localStorage.setItem(\"playerinfo_gold\",playerInfo.gold);\n                gameInstance.gameView.updateGold();\n                gameInstance.sdkHelper.uploadPlayerInfo();\n            }\n        }\n        else if(this.skinType == 3) gameInstance.soundManager.playSound(\"glass\");\n    },\n\n    playPart(index){\n        let go = cc.instantiate(gameInstance.gameView.particles[index].node);\n        go.parent = this.node.parent;\n        go.position = this.node.position;\n        go.active = true;\n    },\n\n\n    move(){\n        this.moving = true;\n        this.node.stopAllActions();\n        let info = gameInstance.gameView.getCurLevelInfo();\n        let targets = gameInstance.gameView.getCurTargetsInfo();\n        if(this.index == targets.length - 1){\n            this.index = 0;\n            let next = targets[this.index];\n            if(next == undefined) return;\n            if(info.polyType != 2){\n                this.node.runAction(\n                    cc.sequence(\n                        cc.moveTo(1 / this.speed,cc.v2(next.startX, next.startY)),\n                        cc.callFunc(function(){\n                            this.move();\n                        }.bind(this))\n                    )\n                )\n            }\n            else{\n                this.node.runAction(\n                    cc.sequence(\n                        cc.fadeOut(1 / this.speed / 4),\n                        cc.delayTime(1 / this.speed / 2),\n                        cc.moveTo(0,cc.v2(next.startX, next.startY)),\n                        cc.fadeIn(1 / this.speed / 4),\n                        cc.callFunc(function(){\n                            this.move();\n                        }.bind(this))\n                    )\n                )\n            }\n        }\n        else{\n            this.index++;\n            let next = targets[this.index];\n            if(next == undefined) return;\n            this.node.runAction(\n                cc.sequence(\n                    cc.moveTo(1 / this.speed,cc.v2(next.startX, next.startY)),\n                    cc.callFunc(function(){\n                        this.move();\n                    }.bind(this))\n                )\n            )\n        }        \n    },\n    \n    stopMove(){\n        this.moving = false;\n        this.node.stopAllActions();\n    },\n\n    pauseMove(){\n        this.node.pauseAllActions();\n    },\n\n    resumeMove(){\n        this.node.resumeAllActions();\n    },\n});\n"]}