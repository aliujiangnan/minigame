{"version":3,"sources":["../../../../../assets/script/game/assets/script/game/SDKHelper.js"],"names":["HttpApi","require","playerInfo","cc","Class","extends","Component","properties","adCallback","default","visible","gameId","onLoad","start","login","username","localStorage","getItem","setItem","Date","now","toString","data","create","send","res","Error","getProfile","bind","JSON","parse","playerinfo","gold","skinList","skinlist","shopList","shoplist","useSkin","useskin","lastLevelIndex","lastlevelindex","uploadPlayerInfo","stringify","uploadScore","score","gameInstance","isWeChat","wx","setUserCloudStorage","KVDataList","key","value","success","console","log","complete","highScore","showRank","callback","getOpenDataContext","postMessage","msg","getUserinfos","ids","i","length","userid","share","title","imageUrl","query","imageUrlId","shareAppMessage","canvas","toTempFilePathSync","destWith","destHeight","sys","isNative","os","OS_ANDROID","jsb","reflection","callStaticMethod","type","OS_IOS","showAd","onAdCallback","status"],"mappings":"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","file":"SDKHelper.js","sourceRoot":"../../../../../assets/script/game","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\nvar HttpApi = require(\"HttpApi\");\nvar playerInfo = require(\"../game/PlayerInfo\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        adCallback:{\n            default:null,\n            visible:false,\n        },\n        gameId:{\n            default:\"mini-archer\",\n            visible:false,\n        },\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n\n    },\n\n    start () {\n\n    },\n\n    // update (dt) {},\n\n    login(){\n        var username = localStorage.getItem(\"game_username\");\n        if(username == \"\" || username == null)\n            localStorage.setItem(\"game_username\", Date.now().toString());\n            username = localStorage.getItem(\"game_username\");\n\n        var data = {\n            \"gameid\": this.gameId,\n            \"userid\": username,\n            \"username\": username,\n            \"nickname\": username,\n            \"gender\": 1,\n            \"avatar\": \"http://sandbox-avatar.boochat.cn/2018/01/20/02/3/0042758573.gif\",\n        }\n\n        HttpApi.create(\"post\", \"/login\", data).send(function (res) {\n            if (res.Error) {\n\n            }\n            else {\n                this.getProfile();\n            }\n        }.bind(this))\n    },\n\n    getProfile(){\n        HttpApi.create(\"get\", \"/profile\").send(function (res) {\n            if (res.Error) {\n\n            }\n            else {\n                let data = JSON.parse(res.data).data;\n                if(data.playerinfo){\n                    data = JSON.parse(data.playerinfo)\n                    playerInfo.gold = data.gold;\n                    playerInfo.skinList = data.skinlist;\n                    playerInfo.shopList = data.shoplist;\n                    playerInfo.useSkin = data.useskin;\n                    playerInfo.lastLevelIndex = data.lastlevelindex;\n                }\n            }\n        }.bind(this))\n    },\n\n    uploadPlayerInfo(){\n        var playerinfo = {\n            gold:playerInfo.gold,\n            skinlist:playerInfo.skinList,\n            shoplist:playerInfo.shopList,\n            useskin:playerInfo.useSkin,\n            lastlevelindex:playerInfo.lastLevelIndex,\n        }\n        HttpApi.create(\"post\", \"/userinfo/game\", {playerinfo:JSON.stringify(playerinfo)}).send(function (res) {\n            if (res.Error) {\n\n            }\n            else {\n                \n            }\n        }.bind(this))\n    },\n\n    uploadScore(score){\n        if(gameInstance.isWeChat){\n            wx.setUserCloudStorage({\n                KVDataList: [{key:\"score\",value:score}],\n                success: function(res){\n                    console.log(res);\n                },\n                complete: function(res){\n                    console.log(res);\n                }\n            });\n        }\n        else{\n            HttpApi.create(\"post\", \"/score/report\", {\"score\": playerInfo.highScore.toString(),\"tag\": \"normal\"}).send(function (res) {\n                if (res.Error) {\n    \n                }\n                else {\n    \n                }\n            });\n        }\n    },\n\n    showRank(callback){\n        if(gameInstance.isWeChat){\n            //向开放域发送请求\n            wx.getOpenDataContext().postMessage({\n                msg : \"display\"\n            });\n        }\n        else{\n            function getUserinfos(ids){\n                HttpApi.create(\"get\", \"/getuserinfos\", \"userids=\"+ids).send(function(res){\n                    if(res.Error){\n        \n                    }\n                    else{\n                        callback(JSON.parse(res.data).data)\n                    }\n                }.bind(this));\n            }\n\n            HttpApi.create(\"get\", \"/ranks/global\", \"tag=score:normal\").send(function(res){\n                if(res.Error){\n            \n                }\n                else{\n                    var ids = \"\";\n                    var data = JSON.parse(res.data).data\n                    for(let i = 0; i < data.length; ++i){\n                        ids += (data[i].userid + (i == data.length - 1 ? \"\" : \",\"))\n                    }\n    \n                    getUserinfos(ids);\n                }\n            }.bind(this));\n        }\n    },\n    \n    //分享方法（主动转发）\n    //参数：标题，图片路径，查询字符串，审核过的图片ID\n    share(title,imageUrl,query,imageUrlId){\n        title = title ? title : \"有一种梦想叫『称霸朋友圈』，别迷恋哥，哥只是个传说。\";\n        imageUrl = imageUrl ? imageUrl : \"https://miniarcher-1256660609.cos.ap-chengdu.myqcloud.com/share/archery.png\";\n        if(gameInstance.isWeChat){\n            wx.shareAppMessage({\n                title: title,\n                imageUrl: imageUrl || canvas.toTempFilePathSync({\n                    destWith : 500,\n                    destHeight: 400\n                }),\n                query: query,\n                imageUrlId : imageUrlId,\n                //判断是否分享成功\n                success: function(){\n                    console.log(\"分享成功\");\n                },\n                complete: function(){\n                    console.log(\"分享失败\");\n                }\n            });\n        }\n        else if (cc.sys.isNative && cc.sys.os == cc.sys.OS_ANDROID) \n        {\n            jsb.reflection.callStaticMethod(\"org/cocos2dx/javascript/AppActivity\", \"showAd\", \"(I)V\",type);\n        } \n        else if (cc.sys.isNative && cc.sys.os == cc.sys.OS_IOS) \n        {\n\n        }\n        else{\n\n        }\n    },\n\n    showAd(type, callback){\n        this.adCallback = callback;\n\n        if(gameInstance.isWeChat){\n\n        }\n        else if (cc.sys.isNative && cc.sys.os == cc.sys.OS_ANDROID) \n        {\n            jsb.reflection.callStaticMethod(\"org/cocos2dx/javascript/AppActivity\", \"showAd\", \"(I)V\",type);\n        } \n        else if (cc.sys.isNative && cc.sys.os == cc.sys.OS_IOS) \n        {\n\n        }\n        else{\n            this.onAdCallback(\"played\");\n        }\n    },\n\n    onAdCallback(status){\n        console.log(\"onAdCallback, status: \" + status)\n        if(this.adCallback != null)this.adCallback(status);\n        this.adCallback = null;\n    },\n});\n"]}