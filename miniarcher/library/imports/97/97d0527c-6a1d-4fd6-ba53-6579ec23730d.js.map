{"version":3,"sources":["../../../../../assets/script/view/assets/script/view/ShopView.js"],"names":["playerInfo","require","cc","Class","extends","Component","properties","items","default","type","curSpr","Sprite","ui_skin","SpriteAtlas","goldLabel","Label","start","i6","windowSize","view","getVisibleSize","cur","height","width","toFixed","widget","node","parent","getComponent","Widget","top","updateAlignment","init","skinList","JSON","parse","shopList","i","length","item","selfSpr","spriteFrame","getSpriteFrame","skinNo","color","useSkin","string","gold","onClickItem","eve","data","gameInstance","soundManager","playSound","index","no","stringify","gameView","player","updateSkin","sys","localStorage","setItem","sdkHelper","uploadPlayerInfo","onBtnUnlock","hasNum","delay","Math","max","lastIdx","func","idx","parseInt","random","scale","stopAllActions","runAction","sequence","scaleTo","easing","easeQuadraticActionOut","easeQuadraticActionIn","startView","updateSkinNum","updateGold","setTimeout","gotSkinView","active","bind","onBtnPlayAd","showAd","status","onBtnExit"],"mappings":"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","file":"ShopView.js","sourceRoot":"../../../../../assets/script/view","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nvar playerInfo = require(\"../game/PlayerInfo\");\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n        items: {\r\n            default: [],\r\n            type: [require(\"ShopItem\")]\r\n        },\r\n        curSpr: {\r\n            default: null,\r\n            type: cc.Sprite,\r\n        },\r\n        ui_skin: {\r\n            default: null,\r\n            type: cc.SpriteAtlas,\r\n        },\r\n        goldLabel: {\r\n            default: null,\r\n            type: cc.Label,\r\n        }\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {},\r\n\r\n    start() {\r\n        let i6 = 1334 / 750;\r\n        let windowSize = cc.view.getVisibleSize();\r\n        let cur = windowSize.height / windowSize.width;\r\n\r\n        if (cur.toFixed(3) > i6.toFixed(3)) {\r\n            let widget = this.goldLabel.node.parent.parent.getComponent(cc.Widget);\r\n            widget.top = 225;\r\n            widget.updateAlignment();\r\n        }\r\n    },\r\n\r\n    init() {\r\n\r\n        let skinList = JSON.parse(playerInfo.skinList);\r\n        let shopList = JSON.parse(playerInfo.shopList);\r\n\r\n        for (let i = 0; i < this.items.length; ++i) {\r\n            let item = this.items[i];\r\n            item.selfSpr.spriteFrame = this.ui_skin.getSpriteFrame(\"skin_p\" + shopList[i]);\r\n            item.skinNo = shopList[i];\r\n            item.selfSpr.node.color = skinList[shopList[i] - 1] == 1 ? cc.color(255, 255, 255) : cc.color(0, 0, 0);\r\n        }\r\n        this.curSpr.spriteFrame = this.ui_skin.getSpriteFrame(\"skin_p\" + playerInfo.useSkin);\r\n        this.goldLabel.string = playerInfo.gold + \"\";\r\n    },\r\n\r\n    onClickItem(eve, data) {\r\n        gameInstance.soundManager.playSound(\"btn\");\r\n        let skinList = JSON.parse(playerInfo.skinList);\r\n        let shopList = JSON.parse(playerInfo.shopList);\r\n        let index = JSON.parse(data);\r\n        let no = playerInfo.useSkin;\r\n        if (skinList[shopList[index] - 1] == 0) {\r\n            return;\r\n        }\r\n        playerInfo.useSkin = this.items[index].skinNo;\r\n        shopList[index] = no;\r\n        playerInfo.shopList = JSON.stringify(shopList);\r\n        this.items[index].skinNo = no;\r\n        this.items[index].selfSpr.spriteFrame = this.ui_skin.getSpriteFrame(\"skin_p\" + no);\r\n        this.curSpr.spriteFrame = this.ui_skin.getSpriteFrame(\"skin_p\" + playerInfo.useSkin);\r\n        gameInstance.gameView.player.updateSkin();\r\n\r\n        cc.sys.localStorage.setItem(\"playerinfo_useskin\", playerInfo.useSkin);\r\n        cc.sys.localStorage.setItem(\"playerinfo_shoplist\", playerInfo.shopList);\r\n        gameInstance.sdkHelper.uploadPlayerInfo();\r\n    },\r\n\r\n    onBtnUnlock() {\r\n        gameInstance.soundManager.playSound(\"btn\");\r\n        if (playerInfo.gold < 30) return;\r\n        let skinList = JSON.parse(playerInfo.skinList);\r\n        let shopList = JSON.parse(playerInfo.shopList);\r\n        let hasNum = 0;\r\n        for (let i = 0; i < skinList.length; ++i)\r\n            if (skinList[i] == 1) hasNum++;\r\n        if (hasNum == skinList.length) return;\r\n\r\n        let delay = Math.max(0.3 * (10 - hasNum) / 9, .2);\r\n        let lastIdx = -1;\r\n        let func = function () {\r\n            while (true) {\r\n                let idx = parseInt(Math.random() * 9);\r\n                if (skinList[shopList[idx] - 1] == 1 || (hasNum < 9 && idx == lastIdx)) continue;\r\n\r\n                this.items[idx].selfSpr.node.scale = 1;\r\n                this.items[idx].selfSpr.node.stopAllActions();\r\n\r\n                this.items[idx].selfSpr.node.runAction(cc.sequence(\r\n                    cc.scaleTo(.1, 1.2).easing(cc.easeQuadraticActionOut()),\r\n                    cc.scaleTo(.1, 1).easing(cc.easeQuadraticActionIn()),\r\n                ))\r\n\r\n                if (hasNum == 9 || delay < 0.15) {\r\n                    skinList[shopList[idx] - 1] = 1;\r\n                    this.items[idx].selfSpr.node.color = cc.color(255, 255, 255);\r\n                    playerInfo.skinList = JSON.stringify(skinList);\r\n                    cc.sys.localStorage.setItem(\"playerinfo_skinlist\", playerInfo.skinList);\r\n                    playerInfo.gold -= 30;\r\n                    cc.sys.localStorage.setItem(\"playerinfo_gold\", playerInfo.gold);\r\n                    gameInstance.startView.updateSkinNum();\r\n                    gameInstance.gameView.updateGold();\r\n                    this.goldLabel.string = \"\" + playerInfo.gold;\r\n\r\n                    setTimeout(function () {\r\n                        gameInstance.gotSkinView.node.active = true;\r\n                        gameInstance.gotSkinView.init(shopList[idx], 1);\r\n                    }, .2)\r\n\r\n                    gameInstance.sdkHelper.uploadPlayerInfo();\r\n                    break;\r\n                }\r\n\r\n                setTimeout(func, delay * 1000)\r\n                delay -= 0.01;\r\n                lastIdx = idx;\r\n                break;\r\n            }\r\n\r\n        }.bind(this);\r\n\r\n        func();\r\n    },\r\n\r\n    onBtnPlayAd() {\r\n        gameInstance.soundManager.playSound(\"btn\");\r\n        gameInstance.sdkHelper.showAd(2, function (status) {\r\n            if (status == \"played\") {\r\n                playerInfo.gold += 10;\r\n                cc.sys.localStorage.setItem(\"playerinfo_gold\", playerInfo.gold);\r\n                gameInstance.gameView.updateGold();\r\n                gameInstance.sdkHelper.uploadPlayerInfo();\r\n                this.goldLabel.string = playerInfo.gold + \"\";\r\n            }\r\n        }.bind(this))\r\n    },\r\n\r\n    onBtnExit() {\r\n        gameInstance.soundManager.playSound(\"btn\");\r\n        this.node.active = false;\r\n\r\n        if(Math.random() < .3)\r\n            gameInstance.sdkHelper.showAd(1);\r\n    },\r\n});\r\n"]}