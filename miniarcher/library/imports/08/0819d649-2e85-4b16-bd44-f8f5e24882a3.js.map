{"version":3,"sources":["../../../../../assets/script/view/assets/script/view/RankContent.js"],"names":["cc","Class","extends","Component","properties","itemPre","default","type","require","itemNos","visible","items","loading","Node","isShowData","update","isShowRLData","_this","wx","onMessage","data","msg","getUserListData","self","getFriendCloudStorage","keyList","success","console","log","res","init","start","runAction","repeatForever","rotateBy","dataList","active","i","length","no","getItem","item","getComponent","avatar","nickname","parent","node","push","go","instantiate","pop","onClose"],"mappings":"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","file":"RankContent.js","sourceRoot":"../../../../../assets/script/view","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        itemPre:{\n            default:null,\n            type:require(\"RankItem\")\n        },\n        itemNos:{\n            default:[],\n            visible:false,\n        },\n        items:{\n            default:[],\n            visible:false,\n        },\n        loading:{\n            type:cc.Node,\n            default:null,\n        },\n        //是否查询数据\n        isShowData:{\n            default: false,\n            visible: false,\n        },\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n    update: function(){\n        // this.isShowRLData();\n    },\n\n    isShowRLData: function () {\n        var _this = this;\n        wx.onMessage(data => {\n            if(data.msg == \"display\"){\n                //更新状态\n                if(_this.isShowData)return;\n                _this.isShowData = true;\n                //显示排行榜数据\n                this.getUserListData();\n            }\n        });\n    },\n\n    getUserListData() {\n        let self = this;\n        wx.getFriendCloudStorage({\n            keyList: [\"score\"],\n            success: res => {\n                console.log(\"self => \",self,\"res.data => \", res.data);\n                self.init(res.data);\n            }\n        });\n    },\n\n    start () {\n        this.loading.runAction(cc.repeatForever(cc.rotateBy(1,180)))\n    },\n    \n    init(dataList){\n        this.loading.active = false;\n        // var dataList = [\n        //     {\n        //         avatarUrl:\"https://wx.qlogo.cn/mmopen/vi_32/ggopXgXL20fxbj2jcSROnj5gmyj3ia4U11K4HFIcf8zBhhAYjqMdAOibFTapSYZfbtSf6DicssUZArserHXPIoPWQ/132?aaa=aa.jpg\",\n        //         nickname:\"玩家1\",\n        //         openid:\"123\",\n        //         KVDataList:[{key:\"score\",value:\"1\"},{key:\"score\",value:\"2\"}],\n        //     },\n        //     {\n        //         avatarUrl:\"https://wx.qlogo.cn/mmopen/vi_32/ggopXgXL20fxbj2jcSROnj5gmyj3ia4U11K4HFIcf8zBhhAYjqMdAOibFTapSYZfbtSf6DicssUZArserHXPIoPWQ/132?aaa=aa.jpg\",\n        //         nickname:\"玩家2\",\n        //         openid:\"123\",\n        //         KVDataList:[{key:\"score\",value:\"2\"},{key:\"score\",value:\"3\"}],\n        //     },\n        //     {\n        //         avatarUrl:\"https://wx.qlogo.cn/mmopen/vi_32/ggopXgXL20fxbj2jcSROnj5gmyj3ia4U11K4HFIcf8zBhhAYjqMdAOibFTapSYZfbtSf6DicssUZArserHXPIoPWQ/132?aaa=aa.jpg\",\n        //         nickname:\"玩家3\",\n        //         openid:\"123\",\n        //         KVDataList:[{key:\"score\",value:\"3\"},{key:\"score\",value:\"4\"}],\n        //     }\n        // ];\n\n        // function getHighScore(kvlist){\n        //     let score = 0;\n        //     for(let i = 0; i < kvlist.length; ++i){\n        //         let value = parseInt(kvlist[i].value);\n        //         if(score < value)\n        //             score = value;                \n        //     }\n\n        //     return score;\n        // }\n\n        // for(let i = 0; i < dataList.length; ++i){\n        //     dataList[i].highScore = getHighScore(dataList[i].KVDataList);\n        // }\n\n        // for(let i = 0; i < dataList.length; ++i){\n        //     for(let j = i; j < dataList.length; ++j){\n        //         if(dataList[i].highScore < dataList[j].highScore){\n        //             let data = {\n        //                 avatarUrl:dataList[j].avatarUrl,\n        //                 nickname:dataList[j].nickname,\n        //                 openid:dataList[j].openid,\n        //                 KVDataList:dataList[j].KVDataList,\n        //                 highScore:dataList[j].highScore,\n        //             };\n        //             dataList[j] = dataList[i];\n        //             dataList[i] = data;\n        //         }\n        //     }\n        // }\n        // for(let i = dataList.length - 1; i >= 0; --i){\n        //     let data = dataList[i];\n        //     let no = this.getItem();\n        //     no.active = true;\n        //     let item = no.getComponent(\"RankItem\");\n        //     item.init(i+1,data.avatarUrl,data.nickname,\"\"+data.highScore);\n        //     no.parent = this.itemPre.node.parent;\n        //     this.items.push(item);\n        // }\n\n        for(let i = dataList.length - 1; i >= 0; --i){\n            let data = dataList[i];\n            let no = this.getItem();\n            no.active = true;\n            let item = no.getComponent(\"RankItem\");\n            item.init(i+1,data.avatar,data.nickname,\"\"+data['score:normal']);\n            no.parent = this.itemPre.node.parent;\n            this.items.push(item);\n        }\n    },\n\n    getItem(){\n        if(this.itemNos.length<=0){\n            let go = cc.instantiate(this.itemPre.node);\n            this.itemNos.push(go);\n        }\n        return this.itemNos.pop();\n    },\n\n    onClose(){\n        for(let i = 0; i < this.items.length; ++i)\n            this.items[i].node.parent = null;\n        this.items = [];\n    },\n});\n"]}