{"version":3,"sources":["../../../../../assets/script/view/assets/script/view/AwardView.js"],"names":["playerInfo","require","cc","Class","extends","Component","properties","new","default","type","Node","skinSpr","Sprite","index","visible","ui_skin","SpriteAtlas","btnPlay","start","init","skinList","JSON","parse","shopList","hasNum","i","length","parseInt","Math","random","spriteFrame","getSpriteFrame","stopAllActions","scale","runAction","repeatForever","sequence","delayTime","scaleTo","easing","easeQuadraticActionOut","easeQuadraticActionIn","onBtnPlay","gameInstance","soundManager","playSound","sdkHelper","showAd","status","stringify","sys","localStorage","setItem","no","useSkin","gameView","player","updateSkin","startView","updateSkinNum","gotSkinView","node","active","uploadPlayerInfo","bind","onBtnClose","state"],"mappings":"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","file":"AwardView.js","sourceRoot":"../../../../../assets/script/view","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nvar playerInfo = require(\"../game/PlayerInfo\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        new:{\n            default:null,\n            type:cc.Node,\n        },\n        skinSpr:{\n            default:null,\n            type:cc.Sprite,\n        },\n        index:{\n            default:0,\n            visible:false,\n        },\n        ui_skin:{\n            default:null,\n            type:cc.SpriteAtlas,\n        },\n        btnPlay:{\n            default:null,\n            type:cc.Node,\n        }\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    start () {\n    },\n    \n    init(){\n        let skinList = JSON.parse(playerInfo.skinList);\n        let shopList = JSON.parse(playerInfo.shopList);\n        let hasNum = 0;\n        for(let i = 0; i < skinList.length; ++i)\n            if(skinList[i] == 1) hasNum++;\n        if(hasNum == skinList.length) return false;\n\n        while(true){\n            let index = parseInt(Math.random() * 9);\n            if(skinList[shopList[index] - 1] == 1) continue;\n\n            this.skinSpr.spriteFrame = this.ui_skin.getSpriteFrame(\"skin_p\"+shopList[index]);\n            this.index = index;\n            break;\n        }\n\n        this.btnPlay.stopAllActions();\n        this.btnPlay.scale = 1;\n        this.btnPlay.runAction(cc.repeatForever(cc.sequence(\n            cc.delayTime(.1),\n            cc.scaleTo(0.1, 1.2).easing(cc.easeQuadraticActionOut(3)),\n            cc.scaleTo(0.1, 1.1).easing(cc.easeQuadraticActionIn(3)),\n            cc.scaleTo(0.1, 1.2).easing(cc.easeQuadraticActionOut(3)),\n            cc.scaleTo(0.1, 1.1).easing(cc.easeQuadraticActionIn(3)),\n            cc.delayTime(2),\n        )))\n\n        return true;\n    },\n\n    onBtnPlay(){\n        gameInstance.soundManager.playSound(\"btn\");\n        gameInstance.sdkHelper.showAd(2,function(status){\n            if(status == \"played\"){\n                let skinList = JSON.parse(playerInfo.skinList);\n                let shopList = JSON.parse(playerInfo.shopList);\n                skinList[shopList[this.index] - 1] = 1;\n                playerInfo.skinList = JSON.stringify(skinList);\n                cc.sys.localStorage.setItem(\"playerinfo_skinlist\",playerInfo.skinList);\n    \n                let no = playerInfo.useSkin;\n                playerInfo.useSkin = shopList[this.index];\n                cc.sys.localStorage.setItem(\"playerinfo_useskin\",playerInfo.useSkin);\n                shopList[this.index] = no;\n                \n                playerInfo.shopList = JSON.stringify(shopList);\n                cc.sys.localStorage.setItem(\"playerinfo_shoplist\",playerInfo.shopList);\n    \n                gameInstance.gameView.player.updateSkin();\n                gameInstance.startView.updateSkinNum();\n    \n                gameInstance.gotSkinView.node.active = true;\n                gameInstance.gotSkinView.init(shopList[this.index], 2);\n                this.node.active = false;\n\n                gameInstance.sdkHelper.uploadPlayerInfo();\n            }\n        }.bind(this));\n    },\n\n    onBtnClose(){\n        gameInstance.soundManager.playSound(\"btn\");\n        this.node.active = false;\n        gameInstance.gameView.state = \"running\";\n    },\n\n});\n"]}